<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" type="text/css" href="style/ckeditor.css">

    <link rel="stylesheet" type="text/css" href="style/style.css">


</head>

<body>

    <style>
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 48
        }
    </style>

    <overlay>
        <div id="overlay-loading">

        </div>
    </overlay>

    <header>
        <div class="container-fluid">
            <div class="cover-wrapper">

            </div>
        </div>
    </header>

    <main class="main-body">
        <div class="container-fluid">
            <div class="main-wrapper">
                <div class="row">
                    <div class="raw-text__wrapper col" align="center">
                        <div class="editor">

                        </div>
                    </div>
                    <div class="cleaned-text__wrapper col" align="left">
                        <input type="button" class="btn btn-primary" value="Clean HTML" onclick="cleanHTML()">
                        <input type="button" class="btn btn-dark" value="Show Code" onclick="">
                        <button id="copy-code" class="btn btn-outline-primary" onclick=""><span
                                class="material-symbols-outlined">
                                content_paste
                            </span></button>
                        <div id="cleanedHTML__textarea" class=""></div>
                    </div>

                </div>
            </div>
        </div>


    </main>

    <style>
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 48
        }
    </style>


    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>

    <!-- CK5 Editor -->
    <script src="ckeditor5/build/ckeditor.js"></script>
    <script>ClassicEditor
            .create(document.querySelector('.editor'), {
                licenseKey: '',
            })
            .then(editor => {
                window.editor = editor;
            })
            .catch(error => {
                console.error('Oops, something went wrong!');
                console.error('Please, report the following error on https://github.com/ckeditor/ckeditor5/issues with the build id and the error stack trace:');
                console.warn('Build id: q93cuialosul-ulbmhzig3gvu');
                console.error(error);
            });
    </script>


    <!-- FUNCTIONS -->
    <script>

        const removables = [
            // [/error tags/g, 'replacement strings','Error Name','Is this a QA error? -> true or false']
            [/​/g, '', 'Half spaces', true], // removes half spaces
            [/ /g, ' ', 'Narrow spaces', true], // removes narrow spaces
            [/\(as defined in the Terms of Service&nbsp;/g, '(as defined in the Terms of Service', 'Bold characters', false],
            [/&nbsp;/g, ' ', '&nbsp; tags', true],
            [/<br>/g, ' ', '<br> tags', true],
            [/<\/br>/g, ' ', '<br> tags', true],
            [/<span style="color:red;">/g, '', 'Span tags', false], // removes <span> with font colors
            [/<span style="color:black;">/g, '', 'Span tags', false], // removes <span> with font colors
            [/<span style="color:#202124;">/g, '', 'Span tags', false], // removes <span> with font colors
            [/<span style="color:#242424;">/g, '', 'Span tags', false], // removes <span> with font colors
            [/<\/span>/g, '', 'Span tags', false], // removes </span> tags
            [/\(<i>Link to Terms of Service<\/i>\)/g, '', '"Link to Terms Service" lines', true], // removes this line
            [/<i>\(Link to Terms of Service\)<\/i> /g, '', '"Link to Terms Service" lines', true], // removes this line
            [/<i>\(Link to Terms of Service\)<\/i><i>\).<\/i> /g, ').', '"Link to Terms Service" lines', true], // removes this line
            [/<i>\(Link to Standard Promo TCs\)<\/i><strong> by <\/strong>/g, 'by ', 'Bold characters', false], // unbold this line
            [/<strong>My Account &gt; My Balance.<\/strong>/g, 'My Account &gt; My Balance.', 'Bold characters', false], // unbold this line
            [/<strong>Please review these Standard Promotional Terms and Conditions <\/strong>/g, 'Please review these Standard Promotional Terms and Conditions ', 'Bold characters', false], // unbold this line
            [/ am /g, ' AM ', 'Time lettercase', true], // converts pm to uppercase
            [/ pm /g, ' PM ', 'Time lettercase', true], // converts pm to uppercase
            [/<p> <\/p>/g, '', 'Extra <p> tags', true], // cleans empty <p></p> tags
            [/<p><\/p>/g, '', 'Extra <p> tags', true], // cleans empty <p></p> tags
            [/<i>.<\/i>/g, '', 'Font decoration', true], // cleans <i> tags
            [/<br data-cke-filler="true">/g, '', 'Extra <p> tags', true], // cleans empty <p></p> tags
            [/ <strong>here;<\/strong> <i>\(hyperlink to <\/i>!!M2.Promo\/offers\/grouped\?filter=cb/g, ' <a href="!!M2.Promo/offers/grouped?filter=cb">here</a>.', 'Extra <p> tags', true], // wrap in <a> tag
            [/ <strong>here<\/strong><strong>;<\/strong> <i>\(hyperlink to <\/i>!!M2.Promo\/offers\/grouped\?filter=cb/g, ' <a href="!!M2.Promo/offers/grouped?filter=cb">here</a>.', 'Extra <p> tags', true], // wrap in <a> tag
            [/TOWARD BONUS WAGERING: <\/strong>/g, 'TOWARD BONUS WAGERING:</strong>', 'Extra whitespaces', false], 
            [/TOWARD BONUS WAGERING<\/strong>/g, 'TOWARD BONUS WAGERING:</strong>', 'Extra whitespaces', false], 

        ];

        const fixIndentations = [
            [,'hello'],
        ];

        let cleanedText = null;
        let newCleanedText = null;


        const cleanHTML = () => {
            document.getElementById('overlay-loading').style.opacity = "1";
            document.getElementById('overlay-loading').style.visibility = "visible";

            let rawText = document.getElementById('ck5-textarea').innerHTML;
            let count = 0;
            let errorCatcher = [];
            let totalErrors = 0;

            for (let i = 0; i < removables.length; i++) {
                const regex = new RegExp(removables[i][0]);
                const errorName = removables[i][2];
                const qaItem = removables[i][3];
                const replacements = removables[i][1];
                const matches = rawText.match(regex);

                errorCatcher[[i, 0]] = regex;
                errorCatcher[[i, 2]] = errorName;
                errorCatcher[[i, 3]] = qaItem;

                if (matches) {
                    count += matches.length;
                    totalErrors += count;
                    errorCatcher[[i, 1]] = count;
                }

                rawText = rawText.replace(regex, replacements);
                count = 0;

            }

            cleanedText = rawText;
            document.getElementById('cleanedHTML__textarea').innerHTML = cleanedText;
            document.getElementById('overlay-loading').style.opacity = "0";
            document.getElementById('overlay-loading').style.visibility = "hidden";

            gameContributions_indentFix();
        }

        const updateRawTextArea = () => {
            document.getElementById('ck5-textarea').SetHTML = "asdasd";
            alert('nice');
        }

        const gameContributions_indentFix = () => {

            const linesStorageArr = Array.from(cleanedText);
            let step1_search = Array.from('GAME CONTRIBUTIONS TOWARD BONUS WAGERING:');
            let step1_Storage = []
            let step1_Counter = 0;
            let stopLoop = false;
            let tempLinesStorage = linesStorageArr;

            for (let i = 0; i < linesStorageArr.length; i++) {
                if (stopLoop == false) {
                    let tempLinesStorage = linesStorageArr;
                    for (let j = 0; j < step1_search.length; j++) {
                        if (tempLinesStorage[i] == step1_search[j]) {
                            tempLinesStorage.shift();
                            step1_Storage.push(step1_search[j]);
                            step1_Counter++;
                            if (step1_Counter == step1_search.length) {
                                stopLoop = true;
                            }
                        } else {
                            tempLinesStorage = linesStorageArr;
                            step1_Storage = [];
                            tempLinesStorage.shift()
                            step1_Counter = 0;
                            break;

                        };

                    }
                } // if false = will search for the supplied string to start on, if true = means the string has been found

            }
            console.log(step1_Storage);
            // let x = convert_toString(step1_Storage);
            // console.log(fixIndentations);        
        }

        const convert_toString = (toClean_text) => {

            let cleaned_text = '';
            for(let i=0; i < toClean_text.length; i++){
                cleaned_text += toClean_text[i];
            }

            return cleaned_text;

        }

        

    </script>
</body>

</html>