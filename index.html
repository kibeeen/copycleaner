<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
    <link rel="stylesheet" type="text/css" href="style/ckeditor.css">

    <link rel="stylesheet" type="text/css" href="style/style.css">


</head>

<body>

    <style>
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 48
        }
    </style>

    <overlay>
        <div id="overlay-loading">

        </div>
    </overlay>

    <header>
        <div class="container-fluid">
            <div class="cover-wrapper">
                CMS copy cleaner v1.1
            </div>
        </div>
    </header>

    <main class="main-body">
        <div class="container-fluid">
            <div class="main-wrapper">
                <div class="row">
                    <div class="raw-text__wrapper col" align="center">
                        <div class="editor">

                        </div>
                    </div>
                    <div class="cleaned-text__wrapper col" align="left">
                        <input type="button" class="btn btn-primary" value="Clean HTML" onclick="cleanHTML()">
                        <input type="button" class="btn btn-dark" value="Show Code" onclick="">
                        <button id="copy-code" class="btn btn-outline-primary" onclick=""><span
                                class="material-symbols-outlined">
                                content_paste
                            </span></button>
                        <div id="cleanedHTML__textarea" class=""></div>
                    </div>

                </div>
            </div>
        </div>


    </main>

    <style>
        .material-symbols-outlined {
            font-variation-settings:
                'FILL' 0,
                'wght' 400,
                'GRAD' 0,
                'opsz' 48
        }
    </style>


    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>

    <!-- CK5 Editor -->
    <script src="ckeditor5/build/ckeditor.js"></script>
    <script>ClassicEditor
            .create(document.querySelector('.editor'), {
                licenseKey: '',
            })
            .then(editor => {
                window.editor = editor;
            })
            .catch(error => {
                console.error('Oops, something went wrong!');
                console.error('Please, report the following error on https://github.com/ckeditor/ckeditor5/issues with the build id and the error stack trace:');
                console.warn('Build id: q93cuialosul-ulbmhzig3gvu');
                console.error(error);
            });
    </script>





    <!-- FUNCTIONS -->
    <script>

        const removables = [
            // [/error tags/g, 'replacement strings','Error Name','Is this a QA error? -> true or false']
            [/​/g, '', 'Half spaces', true], // removes half spaces
            [/ /g, ' ', 'Narrow spaces', true], // removes narrow spaces
            [/\(as defined in the Terms of Service&nbsp;/g, '(as defined in the Terms of Service', 'Bold characters', false],
            [/&nbsp;/g, ' ', '&nbsp; tags', true],
            [/<br>/g, ' ', '<br> tags', true],
            [/<\/br>/g, ' ', '<br> tags', true],
            [/< \/br>/g, ' ', '<br> tags', true],
            [/<span style="color:red;">/g, '', 'Span tags', false], // removes <span> with font colors
            [/<span style="color:black;">/g, '', 'Span tags', false], // removes <span> with font colors
            [/<span style="color:#202124;">/g, '', 'Span tags', false], // removes <span> with font colors
            [/<span style="color:#242424;">/g, '', 'Span tags', false], // removes <span> with font colors
            [/<\/span>/g, '', 'Span tags', false], // removes </span> tags
            [/\(<i>Link to Terms of Service<\/i>\)/g, '', '"Link to Terms Service" lines', true], // removes this line
            [/<i>\(Link to Terms of Service\)<\/i> /g, '', '"Link to Terms Service" lines', true], // removes this line
            [/<i>\(Link to Terms of Service\)<\/i><i>\).<\/i> /g, ').', '"Link to Terms Service" lines', true], // removes this line
            [/<i>\(Link to Standard Promo TCs\)<\/i><strong> by <\/strong>/g, 'by ', 'Bold characters', false], // unbold this line
            [/<strong>My Account &gt; My Balance.<\/strong>/g, 'My Account &gt; My Balance.', 'Bold characters', false], // unbold this line
            [/<strong>Please review these Standard Promotional Terms and Conditions <\/strong>/g, 'Please review these Standard Promotional Terms and Conditions ', 'Bold characters', false], // unbold this line
            [/<strong>\s*<\/strong>/g, ' ', 'Extra <strong> tags', false], // removes extra strong
            [/<\/strong>\s*<strong>/g, ' ', 'Extra <strong> tags', false], // removes extra strong
            [/ am /g, ' AM ', 'Time lettercase', true], // converts pm to uppercase
            [/ pm /g, ' PM ', 'Time lettercase', true], // converts pm to uppercase
            [/<p><\/p>/g, '', 'Extra <p> tags', true], // cleans empty <p></p> tags
            [/<i>.<\/i>/g, '', 'Font decoration', true], // cleans <i> tags
            [/<br data-cke-filler="true">/g, '', 'Extra <p> tags', true], // cleans empty <p></p> tags
            [/ <strong>here;<\/strong> <i>\(hyperlink to <\/i>!!M2.Promo\/offers\/grouped\?filter=cb/g, ' <a href="!!M2.Promo/offers/grouped?filter=cb">here</a>.', 'Extra <p> tags', true], // wrap in <a> tag
            [/ <strong>here<\/strong><strong>;<\/strong> <i>\(hyperlink to <\/i>!!M2.Promo\/offers\/grouped\?filter=cb/g, ' <a href="!!M2.Promo/offers/grouped?filter=cb">here</a>.', 'Extra <p> tags', true], // wrap in <a> tag
            [/TOWARD BONUS WAGERING: <\/strong>/g, 'TOWARD BONUS WAGERING:</strong>', 'Extra white spaces', false],
            [/TOWARD BONUS WAGERING<\/strong> /g, 'TOWARD BONUS WAGERING:</strong>', 'Extra white spaces', false],
            [/<span style="color:#2C2C2C;">. &lt;MDHHS LOGO - MDHHS logo sized to 3” wide&gt;<\/p>/g, '', 'Unnecessary characters', false],
            [/<strong>DISCLAIMER<\/strong>:/g, '<strong>Disclaimer:</strong>', 'Fixed Capitalization', false],
            [/ <\/p>/g, '</p>', 'Extra white spaces', false],
            [/ <\/li>/g, '</li>', 'Extra white spaces', false],
            [/<p><\/p>/g, '', 'Extra white spaces', false],
            [/ <strong>/g, '<strong>', 'Extra white spaces', false],
            [/<strong> /g, '<strong>', 'Extra white spaces', false],
            [/<p> <strong>/g, '<p><strong>', 'Extra white spaces', false],
            [/<p> <\/p>/g, '', 'Extra white spaces', false], // removes extra white spaces
            [/! <\/p>/g, '!</p>', 'Extra white spaces', false], // removes extra white spaces
            [/<p> /g, '<p>', 'Extra <p> tags', false], // removes extra white spaces
            [/\$10Bonus/g, '$10 Bonus', 'Sticky Text', true],
            [/<p>\[REWARD TILE\]<\/p>/gi, '<span>[REWARD TILE]</span>', 'Rewrite Text', false],
            [/<p>REWARD TILE<\/p>/gi, '<span>[REWARD TILE]</span>', 'Rewrite Text', false],
            [/<p>SUBTITLE:/gi, '', 'Rewrite Text', false],
            [/<p>\[SHORT SUMMARY]\: /gi, '[SHORT SUMMARY]<p>', 'Rewrite Text', false],
            [/<p>\[SHORT SUMMARY\]<\/p>/gi, '<span>[SHORT SUMMARY]</span>', 'Rewrite Text', false],
            [/H1:/g, '', 'Rewrite Text', false],
            [/H2:/g, '', 'Rewrite Text', false],
            [/  /g, ' ', 'Rewrite Text', false],
            [/> </g, '><', 'Rewrite Text', false],
            [/<p>\[promotion details\]<\/p>/g, '<span>[promotion details]</span>', 'Rewrite Text', false],
            [/<p>\[CTA\]<\/p>/g, '<span>[CTA]</span>', 'Rewrite Text', false],
            [/<strong>\[CTA\]<\/strong>/g, '<span>[CTA]</span>', 'Rewrite Text', false],
            [/<p>\[PREVIEW DESCRIPTION\]<\/p>/g, '<span>[PREVIEW DESCRIPTION]</span>', 'Rewrite Text', false],
            [/<p>\[PREVIEW DESCRIPTION\]:<\/p>/g, '<span>[PREVIEW DESCRIPTION]</span>', 'Rewrite Text', false],
            [/<p>\[OVERLAY DESCRIPTION\]<\/p>/g, '<span>[OVERLAY DESCRIPTION]</span>', 'Rewrite Text', false],
            [/<p>\[TOASTER DESCRIPTION\]<\/p>/g, '<span>[TOASTER DESCRIPTION]</span>', 'Rewrite Text', false],
            [/<p>\[HERO IMAGE ART\]<\/p>/g, '<span>[HERO IMAGE ART]</span>', 'Rewrite Text', false],
            [/<p>\[HERO IMAGE ART\] <\/p>/g, '<span>[HERO IMAGE ART]</span>', 'Rewrite Text', false],
            [/<p>\[promotion dates\] /gi, '[promotional dates]<p>', 'Rewrite Text', false],
            [/\[promotional dates\] /gi, '[promotional dates]<p>', 'Rewrite Text', false],
            [/\[promotion description\] /gi, '</p>[promotion description]<p>', 'Rewrite Text', false],
            [/<p>\[FULLVIEW TITLE\]: /gi, '[FULLVIEW TITLE]:<p>', 'Rewrite Text', false],
            [/<p>\[FULLVIEW DESCRIPTION\]: /gi, '[FULLVIEW DESCRIPTION]:<p>', 'Rewrite Text', false],
            [/<p>\[FULLVIEW DESCRIPTION\]<\/p>/gi, '', 'Rewrite Text', false],
            [/<p><strong>\[CTA\] /gi, '[CTA]:<p><strong>', 'Rewrite Text', false],
            [/\[FULLVIEW TITLE\]/gi, '', 'Rewrite Text', false],
            [/<p>\[HERO IMAGE ART\]  <\/p>/gi, '', 'Rewrite Text', false],



        ];

        const header_gameContributionsWrapper = [
            ['<li><strong>', '</strong><ul>'],
            ['<li>', '<ul>'],
            ['<li>', '<ul>'],
            ['<li>', '</li></ul></li>'],
            ['<li>', '<ul>'],
            ['<li>', '</li></ul></li>'],
            ['<li>', '<ul>'],
            ['<li>', '</li></ul></li></ul></li></ul></li></ul>'],
        ];


        const copyFix_settings = [

            {
                "id": 1,
                "headerTitle": "Carousel",
                "startIndexText": "<p><strong>CAROUSEL</strong></p>",
                "endIndexText": "<span>[CTA]</span>",
                "getTextBetweenTags": /<strong>(.*?)<(\/p|\/strong)>/g,
                "wrapInHTML": false
            },
            {
                "id": 2,
                "headerTitle": "Promo Hub Key Terms",
                "startIndexText": "<p><strong>PROMO HUB KEY TERMS</strong></p><span>[HERO IMAGE ART]</span>",
                "endIndexText": "[REWARD TILE]",
                "getTextBetweenTags": /<p>(.*?)<(\/p)>/gi,
                "wrapInHTML": false
            },
            {
                "id": 3,
                "headerTitle": "Promo Landing Page",
                "startIndexText": "[MPP 1080x486]:",
                "endIndexText": "How It Works:",
                "getTextBetweenTags": /<(?:p|strong)>(.*?)<\/(?:p|strong)>/gs,
                "wrapInHTML": false
            },
            {
                "id": 4,
                "headerTitle": "Player Inbox",
                "startIndexText": "[PREVIEW TITLE]",
                "endIndexText": "OVERLAY",
                "getTextBetweenTags": /<(?:p|strong)>(.*?)<\/(?:p|strong)>/gs,
                "wrapInHTML": false
            },

        ]






        var cleanedText = null;




        const cleanHTML = () => {

            let rawText = document.getElementById('ck5-textarea').innerHTML;
            let count = 0;
            let errorCatcher = [];
            let totalErrors = 0;

            for (let i = 0; i < removables.length; i++) {
                const regex = new RegExp(removables[i][0]);
                const errorName = removables[i][2];
                const qaItem = removables[i][3];
                const replacements = removables[i][1];
                const matches = rawText.match(regex);

                errorCatcher[[i, 0]] = regex;
                errorCatcher[[i, 2]] = errorName;
                errorCatcher[[i, 3]] = qaItem;

                if (matches) {
                    count += matches.length;
                    totalErrors += count;
                    errorCatcher[[i, 1]] = count;
                }

                rawText = rawText.replace(regex, replacements);

                count = 0;

            }

            cleanedText = rawText;

            const newCleanedText = cleanedText;
            // document.getElementById('cleanedHTML__textarea').innerHTML = cleanedText;

            indentFix(newCleanedText);
        }

        const convertArray_toString = (toClean_text) => {

            let cleaned_text = '';
            for (let i = 0; i < toClean_text.length; i++) {
                cleaned_text += toClean_text[i];
            }
            return cleaned_text;

        }

        const cleanTags_fromArray = (array, regex) => {

            for (let i = 0; i < array.length; i++) {
                array[i] = array[i].replace(regex, '');
            }

            // removes empty strings from array
            array = array.filter(str => str.trim() !== '');
            
            return array;

        }

        const indentFix = (newCleanedText) => {

            const tempTextStorage = Array.from(cleanedText);
            const tempTextStorage_length = tempTextStorage.length;

            let textWrapper = [];
            // console.log(tempTextStorage);

            let str = convertArray_toString(tempTextStorage);

            // console.log(str);
            // console.log(regexp_gameContributionHeader);

            let getStartIndex = '<li><strong>GAME CONTRIBUTIONS TOWARD BONUS WAGERING:';
            let getEndIndex = '<strong>Order of Funds Used for Wagering:</strong>';
            let matchesStartIndex = [...str.matchAll(getStartIndex)];
            let matchesEndIndex = [...str.matchAll(getEndIndex)];
            let startIndexNumber = 0;
            let endIndexNumber = 0;


            if (matchesStartIndex) {
                matchesStartIndex.forEach((matchesStart) => {
                    startIndexNumber = matchesStart.index;
                    // console.log("match found at " + matchesStart.index);
                    // console.log(tempTextStorage[matchesStart.index]);
                })
            }

            if (matchesEndIndex) {
                matchesEndIndex.forEach((matchesEnd) => {
                    endIndexNumber = matchesEnd.index;
                    // console.log("match found at " + matchesEnd.index);
                    // console.log(tempTextStorage[matchesEnd.index]);
                })
            }


            gameContributions_text = cleanedText.substring(startIndexNumber, endIndexNumber);

            // console.log(gameContributions_text);

            let result = gameContributions_text.match(/<li>(.*?)<(ul|\/li)>/g);

            // console.log(result);


            // console.log(result);
            // console.log(header_gameContributionsWrapper.length); 

            // Remove HTML Tags from array
            let regex = /(<([^>]+)>)/ig;
            for (let i = 0; i < header_gameContributionsWrapper.length; i++) {
                result[i] = result[i].replace(regex, '');
            }

            // Wrap HTML Tags in array
            for (let i = 0; i < header_gameContributionsWrapper.length; i++) {
                textWrapper[i] = header_gameContributionsWrapper[i][0] + result[i] + header_gameContributionsWrapper[i][1];
            }



            // textWrapper = convertArray_toString(textWrapper);
            let tempCleanedText_1 = newCleanedText;
            let tempCleanedText_2 = newCleanedText;


            text_1 = convertArray_toString(Array.from(tempCleanedText_1).splice(0, startIndexNumber));
            text_insert = convertArray_toString(textWrapper);
            text_2 = convertArray_toString(Array.from(tempCleanedText_2).splice(endIndexNumber, tempTextStorage_length));

            cleanedText = text_1 + text_insert + text_2;

            document.getElementById('cleanedHTML__textarea').innerHTML = cleanedText;

            extractDataFromCopy();

            return cleanedText;

            // console.log(cleanedText);


        }


        const extractDataFromCopy = () => {

            for (let i = 0; i < copyFix_settings.length; i++) {
                const copy = cleanedText;
                const settings = copyFix_settings;
                const escape_tags = settings[i].getTextBetweenTags;

                // this is the expression used to clean html tags
                const regex = /(<([^>]+)>)/ig;

                let search_start_text = settings[i].startIndexText;
                let search_end_text = settings[i].endIndexText;

                let start = [...copy.matchAll(search_start_text)];
                let end = [...copy.matchAll(search_end_text)];

                let start_index_length = settings[i].startIndexText.length;
                let end_index_length = settings[i].endIndexText.length;

                let start_index = copy.indexOf(search_start_text);
                let end_index = copy.indexOf(search_end_text);

                // cropped the carousel
                let crop_text_from_copy = copy.substring(start_index + start_index_length, end_index);

                console.log(crop_text_from_copy);

                // insert the matches found into this array
                let cropped_text_escape = crop_text_from_copy.match(escape_tags);

                
                result = cleanTags_fromArray(cropped_text_escape, regex);


                console.log(result);

                console.log(search_start_text);
                console.log(start_index);

                console.log(search_end_text);
                console.log(end_index);
                
                // console.log(cleanedText);
            }





        }
















    </script>
</body>

</html>